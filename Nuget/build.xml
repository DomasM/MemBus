<?xml version="1.0" encoding="utf-8"?>
<Project DefaultTargets="Main" xmlns="http://schemas.microsoft.com/developer/msbuild/2003" ToolsVersion="3.5">
  <PropertyGroup>
    <Configuration>Release</Configuration>
	  <SlnDir>..\</SlnDir>
    <NugetDir>MemBus</NugetDir>
    <NetDir>$(NugetDir)\lib\Net40-Client</NetDir>
    <WinRTDir>$(NugetDir)\lib\NetCore45</WinRTDir>
  </PropertyGroup>
  
  <Target Name="Prepare">
    <MakeDir Directories="$(NetDir);$(WinRTDir)" />
    <MSBuild Projects="$(SlnDir)\MemBus\MemBus.csproj" Properties="Configuration=$(Configuration)" />
    <MSBuild Projects="$(SlnDir)\MemBus.RT\MemBus.RT.csproj" Properties="Configuration=$(Configuration)" />
  </Target>

  <Target Name="BuildApp">
  	<ItemGroup>
  	  <NetAssemblies Include="$(SlnDir)MemBus\bin\$(Configuration)\MemBus.dll" />
      <WinRTAssemblies Include="$(SlnDir)MemBus.RT\bin\$(Configuration)\MemBus.dll" />
  	  <NetDocs Include="$(SlnDir)MemBus\bin\$(Configuration)\MemBus.xml" />
      <WinRTDocs Include="$(SlnDir)MemBus.RT\bin\$(Configuration)\MemBus.xml" />
  	</ItemGroup>
  	
    <Copy SourceFiles="@(NetAssemblies)" DestinationFolder="$(NetDir)" />
  	<Copy SourceFiles="@(NetDocs)" DestinationFolder="$(NetDir)" />
    <Copy SourceFiles="@(WinRTAssemblies)" DestinationFolder="$(WinRTDir)" />
    <Copy SourceFiles="@(WinRTDocs)" DestinationFolder="$(WinRTDir)" />
    <Copy SourceFiles="$(SlnDir)\readme.md" DestinationFiles="$(NugetDir)\readme.md" />
  </Target>

  <Target Name="Main" DependsOnTargets="Prepare;BuildApp">
    <Message Text="Finished setting up Nuget structure into --&gt; $(NugetDir)" Importance="High" />
  </Target>
  
</Project>